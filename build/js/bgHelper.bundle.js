webpackJsonp([0],{0:function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){for(var n=[],r=0;r<t.children.length;r++){var o=t.children[r];if("_"!==o.title[0]){var i=o.children;i?n.push(f.makeFolderTabWindow(o)):console.log("Found bookmarks folder with no children, skipping: ",i)}}return e.registerTabWindows(n)}function a(e,t,n){if(e.children)for(var r=0;r<e.children.length;r++){var o=e.children[r];if(o.title.toLowerCase()===t.toLowerCase())return n(o),!0}console.log("Child folder ",t," Not found, creating...");var i={parentId:e.id,title:t};chrome.bookmarks.create(i,n)}function s(e){var t=null,n=null;chrome.bookmarks.getTree(function(r){var o=r[0].children[1];a(o,M,function(r){console.log("tab manager folder acquired."),t=r.id,a(r,O,function(o){console.log("archive folder acquired."),n=o.id,chrome.bookmarks.getSubTree(r.id,function(r){var o=new p["default"]({folderId:t,archiveFolderId:n}),a=i(o,r[0]);e(a)})})})})}function d(e){chrome.runtime.onConnect.addListener(function(t){t.onMessage.addListener(function(n){var r=n.listenerId;t.onDisconnect.addListener(function(){e.removeViewListener(r)})})})}function l(e){function t(){var t=e.getValue(),n=m.createElement(T["default"],{storeRef:null,initialWinStore:t,noListener:!0}),r=g.renderToString(n);window.savedStore=t,window.savedHTML=r}return t}function u(){s(function(e){v.syncChromeWindows(function(t){console.log("initial sync of chrome windows complete.");var n=t(e);window.storeRef=new I["default"](n);var r=l(window.storeRef);r(),window.storeRef.on("change",r),d(window.storeRef)})})}var c=n(1),p=o(c),h=n(5),f=r(h),w=n(6),v=r(w),b=n(8),m=r(b),W=n(160),I=o(W),S=n(165),g=r(S),y=n(166),T=o(y),M="Tabli Saved Windows",O="_Archive";u()},1:function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var d=n(2),l=r(d),u=n(4),c=r(u),p=n(5),h=r(p),f=function(e){function t(){return o(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),s(t,[{key:"registerTabWindow",value:function(e){var t=e.open?this.windowIdMap.set(e.openWindowId,e):this.windowIdMap,n=e.saved?this.bookmarkIdMap.set(e.savedFolderId,e):this.bookmarkIdMap;return this.set("windowIdMap",t).set("bookmarkIdMap",n)}},{key:"registerTabWindows",value:function(e){return l.reduce(e,function(e,t){return e.registerTabWindow(t)},this)}},{key:"handleTabWindowClosed",value:function(e){var t=this.windowIdMap["delete"](e.openWindowId),n=h.removeOpenWindowState(e);return this.set("windowIdMap",t).registerTabWindow(n)}},{key:"handleTabClosed",value:function(e,t){var n=h.closeTab(e,t);return this.registerTabWindow(n)}},{key:"handleTabSaved",value:function(e,t,n){var r=h.saveTab(e,t,n);return this.registerTabWindow(r)}},{key:"handleTabUnsaved",value:function(e,t){var n=h.unsaveTab(e,t);return this.registerTabWindow(n)}},{key:"attachChromeWindow",value:function(e,t){var n=this.windowIdMap.get(t.id),r=n?this.handleTabWindowClosed(n):this,o=h.updateWindow(e,t);return console.log("attachChromeWindow: attachedTabWindow: ",o.toJS()),r.registerTabWindow(o)}},{key:"syncChromeWindow",value:function(e){var t=this.windowIdMap.get(e.id),n=t?h.updateWindow(t,e):h.makeChromeTabWindow(e);return this.registerTabWindow(n)}},{key:"syncWindowList",value:function(e){var t=this.getOpen(),n=l.map(e,"id"),r=new Set(n),o=l.filter(t,function(e){return!r.has(e.openWindowId)}),i=l.reduce(o,function(e,t){return e.handleTabWindowClosed(t)},this);return l.reduce(e,function(e,t){return e.syncChromeWindow(t)},i)}},{key:"setCurrentWindow",value:function(e){var t=this.getTabWindowByChromeId(e);if(!t)return console.log("setCurrentWindow: window id ",e,"not found"),this;var n=t.set("focused",!0);return this.registerTabWindow(n)}},{key:"removeBookmarkIdMapEntry",value:function(e){return this.set("bookmarkIdMap",this.bookmarkIdMap["delete"](e.savedFolderId))}},{key:"unmanageWindow",value:function(e){var t=this.removeBookmarkIdMapEntry(e),n=h.removeSavedWindowState(e);return t.registerTabWindow(n)}},{key:"attachBookmarkFolder",value:function(e,t){var n=h.makeFolderTabWindow(e),r=h.updateWindow(n,t);return this.registerTabWindow(r)}},{key:"getOpen",value:function(){var e=this.windowIdMap.toIndexedSeq().toArray();return e}},{key:"getAll",value:function(){var e=this.getOpen(),t=this.bookmarkIdMap.toIndexedSeq().filter(function(e){return!e.open}).toArray();return e.concat(t)}},{key:"getTabWindowByChromeId",value:function(e){return this.windowIdMap.get(e)}},{key:"countOpenWindows",value:function(){return this.windowIdMap.count()}},{key:"countSavedWindows",value:function(){return this.bookmarkIdMap.count()}},{key:"countOpenTabs",value:function(){return this.windowIdMap.reduce(function(e,t){return e+t.openTabCount},0)}}]),t}(c.Record({windowIdMap:c.Map(),bookmarkIdMap:c.Map(),folderId:-1,archiveFolderId:-1}));t["default"]=f},160:function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var d=n(161),l=r(d),u=function(e){function t(e){o(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,e));return n.viewListeners=[],n}return a(t,e),s(t,[{key:"addViewListener",value:function(e){var t=this.viewListeners.indexOf(e);return-1===t&&(t=this.viewListeners.length,this.viewListeners.push(e),this.on("change",e)),t}},{key:"removeViewListener",value:function(e){var t=this.viewListeners[e];t?this.removeListener("change",t):console.warn("removeViewListener: No listener found for id ",e),delete this.viewListeners[e]}}]),t}(l.Ref);t["default"]=u},165:function(e,t,n){"use strict";e.exports=n(150)},166:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e){var t=chrome.runtime.connect({name:"popup"});t.postMessage(e),t.onMessage.addListener(function(e){console.log("Got response message: ",e)})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=o(a),d=n(6),l=o(d),u=n(167),c=o(u),p=n(161),h=n(168),f=r(h),w=n(178),v=r(w),b=n(179),m=r(b),W=n(171),I=o(W),S=s.createClass({displayName:"Popup",storeAsState:function(e){var t=e.getAll(),n=t.sort(I.windowCmp);return{winStore:e,sortedWindows:n}},getInitialState:function(){var e=this.storeAsState(this.props.initialWinStore);return e.saveModalIsOpen=!1,e.revertModalIsOpen=!1,e.revertTabWindow=null,e.searchStr="",e.searchRE=null,e},handleSearchInput:function(e){var t=e.trim(),n=null;t.length>0&&(n=new RegExp(t,"i")),console.log("search input: '"+t+"'"),this.setState({searchStr:t,searchRE:n})},openSaveModal:function(e){var t=e.title;this.setState({saveModalIsOpen:!0,saveInitialTitle:t,saveTabWindow:e})},closeSaveModal:function(){this.setState({saveModalIsOpen:!1})},openRevertModal:function(e){this.setState({revertModalIsOpen:!0,revertTabWindow:e.tabWindow})},closeRevertModal:function(){this.setState({revertModalIsOpen:!1,revertTabWindow:null})},doSave:function(e){var t=this.props.storeRef,n=t.getValue().folderId;l.manageWindow(n,this.state.saveTabWindow,e,(0,p.refUpdater)(t)),this.closeSaveModal()},doRevert:function(e){var t=(0,p.refUpdater)(this.props.storeRef);l.revertWindow(this.state.revertTabWindow,t),this.closeRevertModal()},renderSaveModal:function(){var e=null;return this.state.saveModalIsOpen&&(e=s.createElement(v["default"],{initialTitle:this.state.saveInitialTitle,tabWindow:this.state.saveTabWindow,onClose:this.closeSaveModal,onSubmit:this.doSave,appComponent:this})),e},renderRevertModal:function(){var e=null;return this.state.revertModalIsOpen&&(e=s.createElement(f["default"],{tabWindow:this.state.revertTabWindow,onClose:this.closeRevertModal,onSubmit:this.doRevert,appComponent:this})),e},render:function(){var e;try{var t=this.renderSaveModal(),n=this.renderRevertModal(),r=c.filterTabWindows(this.state.sortedWindows,this.state.searchRE);e=s.createElement("div",null,s.createElement(m["default"],{onSearchInput:this.handleSearchInput,winStore:this.state.winStore,storeUpdateHandler:(0,p.refUpdater)(this.props.storeRef),filteredWindows:r,appComponent:this,searchStr:this.state.searchStr,searchRE:this.state.searchRE}),t,n)}catch(o){throw console.error("App Component: caught exception during render: "),console.error(o.stack),o}return e},componentWillMount:function(){var e=this;if(!this.props.noListener){var t=this.props.storeRef,n=t.addViewListener(function(){console.log("TabliPopup: viewListener: updating store from storeRef"),e.setState(e.storeAsState(t.getValue()))});i({listenerId:n})}}});t["default"]=S},179:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){var n=e.length>0?t.itemMatches.count():t.tabWindow.tabItems.count();return n}function a(e,t,n){if(0===t.length){var r=e.tabWindow,o=r.tabItems.get(n);return o}var i=e.itemMatches.get(n);return i.tabItem}Object.defineProperty(t,"__esModule",{value:!0});var s=n(8),d=o(s),l=n(169),u=r(l),c=n(171),p=o(c),h=n(6),f=o(h),w=n(180),v=r(w),b=n(181),m=r(b),W=d.createClass({displayName:"SelectablePopup",getInitialState:function(){return{selectedWindowIndex:0,selectedTabIndex:0}},handlePrevSelection:function(e){if(0!==this.props.filteredWindows.length){var t=this.props.filteredWindows[this.state.selectedWindowIndex];if(t.tabWindow.open&&this.state.selectedTabIndex>0&&!e)this.setState({selectedTabIndex:this.state.selectedTabIndex-1});else if(this.state.selectedWindowIndex>0){var n=this.state.selectedWindowIndex-1,r=this.props.filteredWindows[n],o=this.props.searchStr.length>0?r.itemMatches.count():r.tabWindow.tabItems.count();this.setState({selectedWindowIndex:n,selectedTabIndex:o-1})}}},handleNextSelection:function(e){if(0!==this.props.filteredWindows.length){var t=this.props.filteredWindows[this.state.selectedWindowIndex],n=this.props.searchStr.length>0?t.itemMatches.count():t.tabWindow.tabItems.count();t.tabWindow.open&&this.state.selectedTabIndex+1<n&&!e?this.setState({selectedTabIndex:this.state.selectedTabIndex+1}):this.state.selectedWindowIndex+1<this.props.filteredWindows.length&&this.setState({selectedWindowIndex:this.state.selectedWindowIndex+1,selectedTabIndex:0})}},handleSelectionEnter:function(){if(0!==this.props.filteredWindows.length){var e=this.props.filteredWindows[this.state.selectedWindowIndex],t=a(e,this.props.searchStr,this.state.selectedTabIndex);console.log("opening: ",t.toJS()),f.activateTab(e.tabWindow,t,this.state.selectedTabIndex,this.props.storeUpdateHandler)}},componentWillReceiveProps:function(e){var t=this.state.selectedWindowIndex,n=e.filteredWindows;if(t>=n.length)if(0===n.length)this.setState({selectedWindowIndex:0,selectedTabIndex:-1}),console.log("resetting indices");else{var r=n[n.length-1];this.setState({selectedWindowIndex:n.length-1,selectedTabIndex:i(this.props.searchStr,r)-1})}else{var o=n[t],a=Math.min(this.state.selectedTabIndex,i(this.props.searchStr,o)-1);this.setState({selectedTabIndex:a})}},render:function(){var e=this.props.winStore,t=e.countOpenTabs(),n=e.countOpenWindows(),r=e.countSavedWindows(),o="Tabs: "+t+" Open. Windows: "+n+" Open, "+r+" Saved.";return d.createElement("div",null,d.createElement("div",{style:u["default"].popupHeader},d.createElement(v["default"],{onSearchInput:this.props.onSearchInput,onSearchUp:this.handlePrevSelection,onSearchDown:this.handleNextSelection,onSearchEnter:this.handleSelectionEnter})),d.createElement("div",{style:u["default"].popupBody},d.createElement(m["default"],{winStore:this.props.winStore,storeUpdateHandler:this.props.storeUpdateHandler,filteredWindows:this.props.filteredWindows,appComponent:this.props.appComponent,searchStr:this.props.searchStr,searchRE:this.props.searchRE,selectedWindowIndex:this.state.selectedWindowIndex,selectedTabIndex:this.state.selectedTabIndex})),d.createElement("div",{style:u["default"].popupFooter},d.createElement("span",{style:p.merge(u["default"].closed,u["default"].summarySpan)},o)))}});t["default"]=W},181:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),a=o(i),s=n(182),d=r(s),l=n(187),u=r(l),c=a.createClass({displayName:"TabWindowList",render:function(){for(var e=[],t=[],n=[],r=this.props.filteredWindows,o=0;o<r.length;o++){var i=r[o],s=i.tabWindow,l="tabWindow"+o,c=s.open,p=s.focused,h=o===this.props.selectedWindowIndex,f=h?this.props.selectedTabIndex:-1,w=a.createElement(d["default"],{winStore:this.props.winStore,storeUpdateHandler:this.props.storeUpdateHandler,filteredTabWindow:i,key:l,searchStr:this.props.searchStr,searchRE:this.props.searchRE,isSelected:h,selectedTabIndex:f,appComponent:this.props.appComponent});p?e=w:c?t.push(w):n.push(w)}var v=null;return n.length>0&&(v=a.createElement(u["default"],{title:"Saved Closed Windows"},n)),a.createElement("div",null,a.createElement(u["default"],{title:"Current Window"},e),a.createElement(u["default"],{title:"Other Open Windows"},t),v)}});t["default"]=c},182:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),a=o(i),s=n(183),d=o(s),l=n(4),u=o(l),c=n(169),p=r(c),h=n(171),f=o(h),w=n(6),v=o(w),b=n(177),m=r(b),W=n(184),I=r(W),S=n(186),g=r(S),y=a.createClass({displayName:"FilteredTabWindow",mixins:[m["default"]],getInitialState:function(){return{expanded:null}},componentWillReceiveProps:function(e){e.isSelected&&!this.props.isSelected&&d.findDOMNode(this.refs.windowDiv).scrollIntoViewIfNeeded()},handleOpen:function(){console.log("handleOpen",this,this.props),v.openWindow(this.props.filteredTabWindow.tabWindow,this.props.storeUpdateHandler)},handleClose:function(e){v.closeWindow(this.props.filteredTabWindow.tabWindow,this.props.storeUpdateHandler)},handleRevert:function(e){var t=this.props.appComponent;t.openRevertModal(this.props.filteredTabWindow)},getExpandedState:function(){return null===this.state.expanded?this.props.filteredTabWindow.tabWindow.open:this.state.expanded},renderTabItems:function(e,t){for(var n=[],r=0;r<t.count();r++){var o="tabItem-"+r,i=r===this.props.selectedTabIndex,s=a.createElement(g["default"],{winStore:this.props.winStore,storeUpdateHandler:this.props.storeUpdateHandler,tabWindow:e,tab:t.get(r),key:o,tabIndex:r,isSelected:i,appComponent:this.props.appComponent});n.push(s)}var d=this.getExpandedState(),l=d?p["default"].expandablePanelContentOpen:p["default"].expandablePanelContentClosed,u=f.merge(p["default"].tabList,l);return a.createElement("div",{style:u},n)},handleExpand:function(e){this.setState({expanded:e})},render:function(){var e,t=this.props.filteredTabWindow,n=t.tabWindow;e=0===this.props.searchStr.length?n.tabItems:t.itemMatches.map(function(e){return e.tabItem});var r=this.getExpandedState(),o=null;o=r?this.renderTabItems(n,e):this.renderTabItems(n,u.Seq());var i=a.createElement(I["default"],{winStore:this.props.winStore,storeUpdateHandler:this.props.storeUpdateHandler,tabWindow:n,expanded:r,onExpand:this.handleExpand,onOpen:this.handleOpen,onRevert:this.handleRevert,onClose:this.handleClose,appComponent:this.props.appComponent}),s=this.props.isSelected?p["default"].tabWindowSelected:null,d=f.merge(p["default"].tabWindow,p["default"].expandablePanel,s);return a.createElement("div",{ref:"windowDiv",style:d,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut},i,o)}});t["default"]=y}});